#!/bin/bash

mf="Makefile"

SRC="main.c zlprg.c"
OBJ="`echo "$SRC" | sed 's:\.c:\.o:g'`"

echo "${0}: creating Makefile base..."

echo -n '
CC=gcc

FLAGS_BASIC=-Wall 
CFLAGS=$(FLAGS_BASIC) -g
#CFLAGS=$(FLAGS_BASIC) -O3

LIBS_BASIC=-lm
#CLIBS=$(LIBS_BASIC) -lefence
CLIBS=$(LIBS_BASIC)

BIN_NAME=ezdlin



all: ' > $mf
echo -n "$OBJ" >> $mf
echo -n '
	$(CC) $(CFLAGS) -o $(BIN_NAME) ' >> $mf
echo -n "$OBJ" >> $mf
echo -n ' $(CLIBS)


clean:
	rm -f *.o
	rm -f $(BIN_NAME)


' >> $mf


# automaticly generate (local) file dependences
for src in $SRC
do
  echo "${0}: making dep for $src"
  gcc -MM $src >> $mf || exit $?
  echo ""      >> $mf
done

